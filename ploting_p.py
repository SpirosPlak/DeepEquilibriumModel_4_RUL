import matplotlib.pyplot as plt
import numpy as np
from matplotlib.ticker import ScalarFormatter
import os

# Get the directory of the currently running script
script_dir = os.path.dirname(os.path.abspath(__file__))

# Change the working directory to the script's directory
os.chdir(script_dir)

# Define the data for all four datasets (replace with your actual results)
sresiduals_FD001 = [8.109811184614704e-05, 8.682961548590262e-05, 8.603869229836133e-05, 8.562554473334378e-05, 9.089179203046711e-05, 8.646284813635405e-05, 8.693071554418942e-05, 8.271767866721473e-05, 8.754757700130697e-05, 9.303115313804452e-05, 8.15654350625319e-05, 8.344482055941501e-05, 8.811872236225915e-05, 9.027505250836337e-05, 9.143277616360514e-05, 9.15510098475979e-05, 8.610834554239209e-05, 8.882376503857688e-05, 9.006035317474141e-05, 8.977630292567231e-05, 9.253955005110113e-05, 8.907263879242739e-05, 8.764483585576366e-05, 8.956828267024509e-05, 9.23121727376791e-05, 9.312542282839723e-05, 9.43871221760015e-05, 9.334715312057785e-05, 9.257233388529255e-05, 9.421368605248502e-05, 9.57275487649142e-05, 9.557274072370813e-05, 9.635081105757151e-05, 9.348358886701793e-05, 9.073754762508103e-05]
siterations_FD001 = [10.96551724137931, 12.60344827586207, 13.60344827586207, 13.89655172413793, 14.241379310344827, 14.655172413793103, 13.379310344827585, 13.0, 13.0, 13.068965517241379, 14.0, 14.0, 14.0, 14.0, 14.0, 14.275862068965518, 14.982758620689655, 15.0, 15.0, 15.0, 15.344827586206897, 15.637931034482758, 15.982758620689655, 16.0, 16.0, 16.0, 16.0, 16.25862068965517, 16.24137931034483, 16.103448275862068, 16.103448275862068, 16.0, 16.017241379310345, 16.396551724137932, 16.67241379310345]

# Add similar data for FD002, FD003, FD004 here...
# Example for FD002
sresiduals_FD002 = [0.00019454019913647076, 9.41926625032187e-05, 9.214765364327943e-05, 8.949665066613467e-05, 8.608876139703238e-05, 8.511658357796861e-05, 8.688109278873711e-05, 8.758247198796748e-05, 8.682238531408224e-05, 8.914771360712645e-05, 8.843354480879596e-05, 9.001766560760763e-05, 9.000992898783349e-05, 9.217375666093157e-05, 9.346547414593043e-05, 9.399087668783e-05, 9.192858475575629e-05, 9.067190768867161e-05, 9.194120750279439e-05, 9.345315169300694e-05, 8.913142456939178e-05, 8.942683790232289e-05, 9.041027291471987e-05, 9.20662072171983e-05, 9.290573353875986e-05, 9.206308414850726e-05, 8.995649831481975e-05, 8.902160557134229e-05, 8.794487882437197e-05, 8.69331561261788e-05, 8.626362275400319e-05, 8.657319727828916e-05, 8.690887392929368e-05, 8.717525010329805e-05, 8.781515404369784e-05]
siterations_FD002 = [16.829931972789115, 11.959183673469388, 11.095238095238095, 10.619047619047619, 9.89795918367347, 9.829931972789115, 9.700680272108844, 9.517006802721088, 10.0, 10.29251700680272, 10.755102040816327, 10.993197278911564, 11.700680272108844, 11.857142857142858, 12.170068027210885, 12.149659863945578, 12.17687074829932, 12.748299319727892, 12.510204081632653, 12.394557823129253, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0]

sresiduals_FD003 = [4.666914620819235e-05, 4.730750318101075e-05, 7.616829087575232e-05, 6.675183358311188e-05, 8.00190384844817e-05, 5.914143117219542e-05, 6.511670897972571e-05, 7.812862427921832e-05, 8.273601041374994e-05, 8.821689428129632e-05, 8.588928831159137e-05, 8.855576306814328e-05, 9.006580699601077e-05, 8.162932697034974e-05, 9.575724824182025e-05, 6.679577277931717e-05, 7.16311858143724e-05, 3.768483230877402e-05, 3.772289887170441e-05, 4.882228729132164e-05, 3.674632742851307e-05, 3.83434360888454e-05, 3.9991534660137924e-05, 3.653516297552934e-05, 3.8008538987404404e-05, 4.0888975802642694e-05, 4.3837198557282263e-05, 4.613335872168786e-05, 4.535349570297902e-05, 4.530572415595608e-05, 4.335249681649397e-05, 4.771801884219583e-05, 4.888473361331437e-05, 4.650454216711556e-05, 4.602211208423666e-05]
siterations_FD003 = [8.17142857142857, 8.0, 8.228571428571428, 8.442857142857143, 8.17142857142857, 8.971428571428572, 9.0, 9.0, 9.0, 9.0, 9.0, 9.0, 9.0, 9.257142857142858, 9.014285714285714, 9.528571428571428, 9.4, 9.971428571428572, 10.0, 9.8, 10.0, 9.957142857142857, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0]

sresiduals_FD004 = [4.629765501090862e-05, 6.0786133999076704e-05, 5.565338161368557e-05, 4.768837594425815e-05, 6.850324595244845e-05, 6.849385082987706e-05, 7.143836879803594e-05, 7.838040940885887e-05, 6.501814759969927e-05, 6.24514488113481e-05, 6.398383843483062e-05, 7.08309207131902e-05, 7.270502892213192e-05, 6.984984097365415e-05, 7.391439238174001e-05, 8.011613920453508e-05, 8.114433523249233e-05, 8.302382069137652e-05, 8.456120009890751e-05, 7.99294200480163e-05, 7.098811853888206e-05, 7.852117562643523e-05, 8.413747449129344e-05, 8.404635754718477e-05, 8.78115205163932e-05, 7.959117566886477e-05, 8.363073995793075e-05, 8.344922634721517e-05, 8.170895713657617e-05, 8.419091284659496e-05, 8.902548151402084e-05, 9.045941484611492e-05, 8.287076220873386e-05, 8.499276242049703e-05, 7.862451677156483e-05]
siterations_FD004 = [9.029069767441861, 9.034883720930232, 8.063953488372093, 8.0, 8.36046511627907, 9.372093023255815, 10.412790697674419, 10.505813953488373, 9.88953488372093, 9.575581395348838, 9.69186046511628, 9.633720930232558, 9.186046511627907, 9.180232558139535, 9.459302325581396, 9.44186046511628, 9.738372093023257, 10.337209302325581, 11.029069767441861, 11.470930232558139, 11.953488372093023, 12.0, 12.05813953488372, 12.05232558139535, 12.13953488372093, 12.093023255813954, 12.203488372093023, 12.372093023255815, 12.75, 12.587209302325581, 13.075581395348838, 13.05232558139535, 13.540697674418604, 13.261627906976743, 13.784883720930232]


# Set smaller font sizes for compact publication visuals
plt.rcParams.update({
    "font.size": 8,
    "font.family": "serif",
    "axes.labelsize": 8,
    "axes.titlesize": 9,
    "legend.fontsize": 7,
    "xtick.labelsize": 7,
    "ytick.labelsize": 7,
    "lines.linewidth": 1,
    "lines.markersize": 3,
    "axes.grid": True,
    "grid.alpha": 0.25,
    "grid.linestyle": "--",
    "figure.dpi": 600,
    "legend.frameon": False
})

# Color palette (colorblind-friendly)
colors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728']

# Epochs
epochs = np.arange(1, len(sresiduals_FD001) + 1)

# Create subplots
fig, axs = plt.subplots(2, 1, figsize=(6, 4), sharex=True)

# === Residuals Plot ===
axs[0].plot(epochs, sresiduals_FD001, label='FD001', marker='o', color=colors[0])
axs[0].plot(epochs, sresiduals_FD002, label='FD002', marker='s', color=colors[1])
axs[0].plot(epochs, sresiduals_FD003, label='FD003', marker='^', color=colors[2])
axs[0].plot(epochs, sresiduals_FD004, label='FD004', marker='D', color=colors[3])
axs[0].set_ylabel("Residual")
axs[0].set_title("Residuals per Epoch", pad=4)
axs[0].yaxis.set_major_formatter(ScalarFormatter(useMathText=True))
axs[0].ticklabel_format(style='sci', axis='y', scilimits=(0, 0))
axs[0].legend(loc='upper right', ncol=2)

# === Iterations Plot ===
axs[1].plot(epochs, siterations_FD001, label='FD001', marker='o', color=colors[0])
axs[1].plot(epochs, siterations_FD002, label='FD002', marker='s', color=colors[1])
axs[1].plot(epochs, siterations_FD003, label='FD003', marker='^', color=colors[2])
axs[1].plot(epochs, siterations_FD004, label='FD004', marker='D', color=colors[3])
axs[1].set_xlabel("Epoch")
axs[1].set_ylabel("Iterations")
axs[1].set_title("Iterations per Epoch", pad=4)

# Final layout
plt.tight_layout(pad=1.2)
plt.savefig(f'iteration_per_epoch.png', dpi=300, bbox_inches='tight', transparent=True)

plt.show()